{% extends "base.html" %}


{% block cssblock %}
<style>

    .contain{
        position: relative;
        top:30%;
        color:white;
        width:100%;
    }
    #customers {
        margin:auto;
        font-family: Arial, Helvetica, sans-serif;
        border-collapse: collapse;
        width: 80%;
      }
      
      #customers td, #customers th {
        border: 1px solid #ddd;
        padding: 8px;
      }
      #customers tr{
        cursor: pointer;
      }
      
      
      #customers tr:hover {background-color: #ddd;color:black;}

      #customers th {
        padding-top: 12px;
        padding-bottom: 12px;
        text-align: left;
        background-color: #04AA6D;
        color: white;
      }
 </style>
</style>

{% endblock cssblock %}
{% block content %}

<div class="container">
    <div class="contain">

    
   
   <table id="customers">
    <tr>
      <th>Station</th>
      <th>Arrival</th>
      <th>Departure</th>
      <th>Platform</th>
    
    </tr>
    {% for i  in route_stops %}
    
   
    <tr id = "{{i.route_stops.id}}">
      <td  >{{i.route_stops.station.name}}</td>
      <td>{{i.route_stops.arrival}}</td>
      <td>{{i.route_stops.Departure}}</td>
      <td id="p{{i.id}}">{{i.route_stops.Platform}} </td>
      
    </tr>
    
    
    {% endfor %}

  </table>
</div>


<script>
  let loc = window.location.pathname;
  let parts = loc.split("/")
  let id = parts[parts.length-1]
  


  url = `ws://localhost:8000/ws/platform/${id}`

  const websocketPlatform = new WebSocket(url)


  websocketPlatform.onopen = function(e) {
    console.log("WebSocket connection is open and ready.");
};

websocketPlatform.onmessage = function(e) {
    let data = JSON.parse(e.data);
    console.log(data);
    for (i in data.payload){
      let elem = document.getElementById(i);
      if (elem){
        elem.innerHTML = data.payload[i]
      }

    }
};

websocketPlatform.onclose = function(e) {
    console.log("WebSocket connection closed.");
};

websocketPlatform.onerror = function(e) {
    console.error("WebSocket error:", e);
};


</script>

{% endblock content %}